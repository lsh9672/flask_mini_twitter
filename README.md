# 트위터의 일부 기능을 구현해보는 rest api 서버(2021.11.08~)

> ### 환경

- os: ubuntu 20.04.3LTS
- python : 3.8.10,(flaks == 2.0.2)
- DB : mysql 8.0.27

- 참고 : 깔끔한 파이썬 탄탄한 백엔드 (저자: 송은우)

> ### v 0.1

- #### mysql을 이용하여 3개의 테이블 생성

  1. users: 유저 정보를 저장
  2. tweets : 유저별 트윗 내용 저장
  3. users_follow_list : 각 유저간 팔로우 내용 저장

- #### sqlacodegen을 이용하여 ORM 클래스를 생성

- #### 회원가입과 300자 이내의 글을 쓸수 있는 트위터 엔드포인트를 작성

> ### v 0.2

- #### timeline 엔드포인트를 작성

  1. join연산을 이용하여 자신의 트윗과 팔로우한 사용자의 트윗을 전부 조회해서 json으로 반환

- #### ORM을 통해 쿼리하는 로직을 따로 함수로 분리
  1. 사용자의 정보조회하는 로직 분리
  2. 회원가입시, DB에 insert하는 로직 분리

> ### v 0.3

- #### follow,unfollow 엔드 포인트 작성

  1. 유저 id 값과 follow 할 상대 id값을 받아서 디비에 추가함.
  2. 유저 id 값과 unfollow 할 상대의 id 값을 받아서 디비에서 삭제함.

- #### ORM을 통해 쿼리하는 로직을 따로 함수로 분리
  1. follow 시에 insert하는 로직을 따로 분리
  2. unfollow 시에 delete하는 로직을 따로 분리
  3. timeline출력시에 join연산하는 로직을 따로 분리

> ### v 0.4

- #### 비밀번호에 암호화 적용 및 로그인 기능 추가(JWT 토큰방식)

  1. 기존에 입력된 그대로 저장되던 비밀번호에 bcrypt암호화 알고리즘을 적용해서 암호화하는 함수 작성
  2. 입력받은 이메일과 비밀번호를 받고, 비밀번호는 암호화하고 이메일을 이용해서 데이터베이스에 저장된 암호화된 비밀번호를 가져온후 이 두개를 비교하여 같으면 JWT토큰을 발행함

- #### 회원인증 데코레이터 함수 추가
  1. 로그인이 필요한 기능(엔드포인트)에는 JWT를 받아서 유효한 토큰일 경우에만 사용할수 있도록 하는 로직이 담긴 데코레이터 함수를 만듦
  2. 데코레이터 함수를 로그인이 필요한기능(트윗,팔로우,언팔로우)에 추가함

> ### v 0.5

- #### unit테스트(test_endpoint.py)

  1. 테스트코드를 짜서 파이썬 모듈인 pytest를 이용해서 모든 엔드포인트를 테스트해봄
  2. 유저 두개를 임의로 추가해서 테스트함
  3. 각 엔드포인트 테스트가 끝날때마다 truncate를 사용하여 테이블을 초기화 해줌

- #### 코드수정
  1. 테스트코드 실행시 tweet엔드포인트 테스트 중 멈추는 현상을 발견, 코드를 확인해보니, 디비 접속에 사용한 세션을 닫아주지 않아서 문제가 발생한것이었고, 이를 수정해줌

> ### v 0.6

- #### aws 1차 배포

  1. v 0.5 까지 진행한 것을 aws에 배포함
  2. EC2 2개, RDS, ELB를 이용하여 구성하였고, ELB의 경우 가중치를 두 EC2에 반반씩 할당함.

  ![flask_miniter_ver1](https://user-images.githubusercontent.com/56991244/144227387-c161d898-98f9-4a51-a6bb-b7d178d03c5f.png)

> ### v 1.0
>
> (1차적으로 전체적인 구성도를 완성시켜서 버전 1이라고 명명함)

- #### api 패턴에 따라서 프로젝트 구성

  1. api 패턴중에 많이 사용되는 레이어드 패턴을 사용
  2. presentation , business,persistence로 나누어서 코드를 리팩토링함.

- #### 각 레이어별로 테스트코드를 작성, 테스트
  1. 각 레이어별로 테스트코드를 작성해서 테스트함(test디렉토리)
  2. 테스트 코드를 돌려보며, 에러를 찾아서 수정함.
